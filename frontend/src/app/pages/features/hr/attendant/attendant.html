<div class="attendance-container">
  <!-- Bộ lọc -->
  <div class="filter-section">
    <!-- Chọn tháng -->
    <select [(ngModel)]="filter.month">
      <option value="">Chọn tháng</option>
      <option *ngFor="let m of months" [value]="m">{{ m }}</option>
    </select>

    <!-- Chọn năm -->
    <select [(ngModel)]="filter.year">
      <option value="">Chọn năm</option>
      <option *ngFor="let y of years" [value]="y">{{ y }}</option>
    </select>

    <!-- Chỉ hiển thị với HR -->
    <ng-container *ngIf="role === 'hr'">
      <select [(ngModel)]="filter.departmentId">
        <option value="">Chọn phòng ban</option>
        <option *ngFor="let dep of departments" [value]="dep.id">
          {{ dep.name }}
        </option>
      </select>

      <select [(ngModel)]="filter.status">
        <option value="">Chọn trạng thái</option>
        <option value="PRESENT">PRESENT</option>
        <option value="MISSING_OUTPUT_DATA">MISSING_OUTPUT_DATA</option>
        <option value="MISSING_INPUT_DATA">MISSING_INPUT_DATA</option>
        <option value="ABSENT">ABSENT</option>
        <option value="ON_LEAVE">ON_LEAVE</option>
      </select>
    </ng-container>

    <button (click)="filterAttendance()">Lọc</button>
  </div>

  <!-- Bảng dữ liệu -->
  <div class="table-section">
    <table *ngIf="attendance && attendance.length > 0; else noData">
      <thead>
        <tr>
          <th>Mã chấm công</th>
          <th>Tên đăng nhập</th>
          <th>Họ tên</th>
          <th>Ngày</th>
          <th>Giờ vào</th>
          <th>Giờ ra</th>
          <th>Ca làm</th>
          <th>Trạng thái</th>
          <th>Minh chứng</th>
          <!-- Cột Xóa chỉ cho HR -->
          <th *ngIf="role === 'hr'"></th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let att of attendance">
          <td>{{ att.attendanceId }}</td>
          <td>{{ att.userName || 'Chưa có' }}</td>
          <td>{{ att.fullNameUser || 'Chưa có' }}</td>
          <td>{{ att.attendanceDate }}</td>
          <td>{{ att.checkIn || 'Chưa có' }}</td>
          <td>{{ att.checkOut || 'Chưa có' }}</td>
          <td>{{ att.shiftName || 'Chưa có' }}</td>
          <td>{{ att.status || 'Chưa có' }}</td>
          <td>
            <button class="proof-btn" (click)="showProof(att)"><span class="material-symbols-outlined">
visibility
</span></button>
          </td>
          <!-- Nút xóa chỉ cho HR -->
          <td *ngIf="role === 'hr'">
            <button class="delete-btn" (click)="deleteAttendance(att.attendanceId)"><span class="material-symbols-outlined">
close
</span></button>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #noData>
      <div class="no-data">Không có dữ liệu chấm công</div>
    </ng-template>
  </div>

  <!-- Popup hiển thị minh chứng -->
  <div class="proof-overlay" *ngIf="selectedProof" (click)="closeProof()"></div>
  <div class="proof-box" *ngIf="selectedProof">
    <div class="proof-header">
      <h3>Minh chứng chấm công</h3>
      <span class="close-icon" (click)="closeProof()"><span class="material-symbols-outlined">
close
</span></span>
    </div>
    <div class="proof-content">
      <div class="proof-image">
        <h4>Ảnh vào</h4>
        <img
          *ngIf="selectedProof.checkInImg; else noInImg"
          [src]="selectedProof.checkInImg"
          alt="Check-in"
        />
        <ng-template #noInImg><p>Không có ảnh</p></ng-template>
      </div>

      <div class="proof-image">
        <h4>Ảnh ra</h4>
        <img
          *ngIf="selectedProof.checkOutImg; else noOutImg"
          [src]="selectedProof.checkOutImg"
          alt="Check-out"
        />
        <ng-template #noOutImg><p>Không có ảnh</p></ng-template>
      </div>
    </div>
  </div>
</div>
