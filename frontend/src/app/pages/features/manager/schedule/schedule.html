<div class="attendance-container">
  <!-- Bộ lọc chỉ chọn tháng -->
  <div class="filter-section">
    <select [(ngModel)]="filter.month">
      <option value="">Chọn tháng</option>
      <option *ngFor="let m of months" [value]="m">{{ m }}</option>
    </select>
    <select [(ngModel)]="filter.year">
      <option value="">Chọn năm</option>
      <option *ngFor="let y of years" [value]="y">{{ y }}</option>
    </select>   
     <select [(ngModel)]="filter.schedule">
      <option value="">Chọn loại lịch</option>
      <option *ngFor="let y of schedule" [value]="y.value">{{ y.name }}</option>
    </select>   
    <button (click)="filterAttendance()">Lọc</button>
    <button *ngIf="role == 'manager'" (click)="upSchedule()">Đăng Lịch</button>
  </div>

  <!-- Bảng dữ liệu -->
  <div class="table-section">
    <table *ngIf="filteredData && filteredData.length > 0 || role == 'employee' ">
      <thead>
        <tr>
          <th>Ngày</th>
          <th>Mã ca</th>
          <th>Tên ca</th>
          <th>Nghỉ phép</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let att of filteredData">
          <td>{{ att.date }}</td>
          <td>{{ att.shiftId || '—' }}</td>
          <td>{{ att.shiftName || '—' }}</td>
          <td>
            <span [class.day-off]="att.isDayOff">
              {{ att.isDayOff ? 'Nghỉ' : 'Làm việc' }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
    <table *ngIf="filterManagerData && filterManagerData.length > 0 || role == 'manager'">
      <thead>
        <tr>
          <th>Mã Nhân Viên</th>
          <th>Tên Nhân viên</th>
          <th>Ca làm</th>
          <th>Chức năng</th>
        </tr>
      </thead>

      <tbody>
  <tr *ngFor="let att of filterManagerData">
    <td>{{ att.employeeId }}</td>
    <td>{{ att.employeeFullName || '—' }}</td>

    <td>
      <select [(ngModel)]="att.selectedDraft">
  <option [ngValue]="null">Ca làm việc</option>
  <option *ngFor="let d of att.drafts" [ngValue]="d">
    {{ d.shiftName }} - {{ d.date }}
  </option>
</select>


    </td>

    <td>
      <button (click)="editShift(att)">Sửa</button>
    </td>
  </tr>
</tbody>

    </table>

  </div>
  <!-- POPUP EDIT SHIFT -->
<div class="overlay" *ngIf="isPopupOpen">
  <div class="popup">
    <h3>Chỉnh sửa ca làm</h3>

    <form (ngSubmit)="submitEdit()">

      <label>Mã nhân viên:</label>
      <input type="text" [(ngModel)]="editData.employeeId" name="employeeId" disabled />

      <label>Ngày:</label>
      <input type="date" [(ngModel)]="editData.date" name="date" />
       <label>Loại ca:</label>
        <div class="type-group">
          <label>
            <input 
              type="radio"
              name="type"
              (change)="changeType(8)"
              value="8"
            />
            Ca 8 tiếng
          </label>

          <label>
            <input 
              type="radio"
              name="type"
              (change)="changeType(6)"
              value="6"
            />
            Ca 6 tiếng
          </label>
        </div>

      <label>Chọn ca:</label>
        <select 
          [(ngModel)]="shiftId" 
          name="shiftId"
          required
        >
          <option [ngValue]="null" disabled selected>-- Chọn ca làm việc --</option>

          <option *ngFor="let s of list" [value]="s.shift_id">
            {{ s.shift_name }} | {{ s.start_time }} → {{ s.end_time }}
          </option>
          <option value="53">AL (Anually Leave)</option>
          <option value="54">SL (Sick Leave)</option>
          <option value="55">PL (Paternity Leave)</option>
          <option value="56">ML (Maternity Leave)</option>
          <option value="57">UL (Unpaid Leave)</option>

        </select>

      <div class="buttons">
        <button type="submit">Lưu</button>
        <button type="button" class="close-btn" (click)="closePopup()">Hủy</button>
      </div>

    </form>

  </div>
</div>

</div>
